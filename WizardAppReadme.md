# SDK Wizard Generated App Overview

This app was generated by the SDK Wizard.  The following provides an overview of the generated code and a few suggestions on where to go to customize the app.

## Table of Contents
- [SDK Version](#sdk-version)
- [Adding Libraries](#adding-libraries)
- [Network Requests](#network-requests)
- [Proxy Classes](#proxy-classes)
- [Service Class](#service-class)
- [Onboarding Customizations](#onboarding-customizations)
- [Add a Custom Menu](#add-a-custom-menu)
- [Data Binding](#data-binding)
- [List Screens](#list-screens)
- [Detail Screens](#detail-screens)
- [Show a Custom Screen](#show-a-custom-screen)
- [Push Notifications](#push-notifications)
- [Configuration Loader](#configuration-loader)
- [Troubleshooting](#Troubleshooting)

## SDK Version
The SDK version used by the application is set in the project.properties file.
```text
sdkVersion=2.0.0
```

## Adding Libraries
Additional SDK libraries such as the Offline OData library can be added by editing app's build.gradle (Module:app) file in the dependencies section as shown below.
```text
// SAP Cloud Android SDK dependencies
implementation group: 'com.sap.cloud.android', name: 'fiori', version: sdkVersion
implementation group: 'com.sap.cloud.android', name: 'onboarding', version: sdkVersion
implementation group:'com.sap.cloud.android', name:'odata', version: sdkVersion
implementation group: 'com.sap.cloud.android', name: 'foundation', version: sdkVersion
implementation group: 'com.sap.cloud.android', name: 'offline-odata', version: sdkVersion
```

## Network Requests
The app is designed to use a single OkHttpClient which is configured when the app is started.  If you wish to make a network request (such as to upload usage data) to the SAP Cloud Platform Mobile Services, you can access an instance of the OkHttpClient using the below code.
```java
AppUsageUploader.upload(ClientProvider.get());
```

## Proxy Classes
The Wizard generated application leverages both service (EntityContainer) and proxy (Entity) classes generated by OData gradle plugin to interact with the specified mobile application hosted in Cloud Platform Mobile Services. Code generated by OData gradle plugin can be found under the `app/build/generated/source/odata directory`.  The settings for the proxy generation are in the app's build.gradle file under an odata section.

Should the OData service change its metadata, corresponding classes will be regenerated on execution of relevant gradle tasks. It will impact the existing application if changes are compatible.  See documentation for what constitutes compatible changes.  `SAPServiceManager` is responsible for instantiating the generated service class.

## Service Class
If you wish to make an OData query, you can access an instance of the service class using the below code.  This example is from the service class generated against the Sample OData Service.

```java
//get the DataService class which we will use to query the Back-End OData service
SAPServiceManager sapServiceManager = ((SAPWizardApplication)getApplication()).getSAPServiceManager();
ESPMContainer espmContainer = sapServiceManager.getESPMContainer();

DataQuery query = new DataQuery()
        .filter(ProductCategory.numberOfProducts.greaterThan(0))
        .orderBy(ProductCategory.mainCategoryName)
        .orderBy(ProductCategory.categoryName);
        ...
```

## Onboarding Customizations
A few of the Welcome screen customizations include the title, app icon, description and privacy terms of service URL.
For additional details consult [Customizing the Welcome Screen](https://help.sap.com/doc/c2d571df73104f72b9f1b73e06c5609a/Latest/en-US/docs/fioriui/onboarding/launchscreenactivity_layout.html#customizing-the-welcome-screen).

## Add a Custom Menu
The following steps will add a custom menu to the `EntitySetListActivity`.

In `EntitySetListActivity.java`, in the `onCreateOptionsMenu`, add the below line.
```java
menu.add( Menu.NONE, 300, 1, "Custom Menu");
```

In the method, onOptionsItemSelected, add the following to handle the click of the menu.
```java
else if (item.getItemId() == 300) {
    LOGGER.debug("Custom menu clicked.");
}
```

## Data Binding
For each entity type, Wizard generates an `UiConnector` class to support UI data binding. CRUD operations implementation can be found under the folder operation. Each type of operation uses in its implementation async API to interact with OData service. UI components invoke methods in `DataContentUtilities` to perform CRUD and completion notification is done via callback.

If any of the entity types have media resources, media linked entity or stream properties, UI components use Glide library to asynchronously load the images.

## List Screens
The Headline value shown on a list screen is specified by the masterPropertyValue.  For an app generated against the SAP Sample Back End OData service, the Customers list screen shows the City instead of LastName.  Edit `CustomersUiConnector.java` and change the value from City to LastName as shown below.

```java
// TODO: Change masterPropertyName value to display the desired property in Item list screen
//private final String masterPropertyName = "City";
private final String masterPropertyName = "LastName";
```

This value can be further customized to perhaps show last name, first name by editing `ItemListActivity.java`, in the onBindViewHolder.

```java
if (entityValueUiConnector.getConnectedObject().getDataType().equals(ESPMContainerMetadata.EntityTypes.customer)) {
    masterPropertyValue = entityValueUiConnector.getPropertiesWithValues().get("LastName") + ", " +
                  entityValueUiConnector.getPropertiesWithValues().get("FirstName");
}
```

The number of entries shown in the list is limited to 200.  This can be changed by editing the `DownloadOperation.java` class and modifying the maximumEntities variable.

## Detail Screens
The detail screen shows each property of the entity.  The list of properties shown can be modified in the `propertyNames` array in the corresponding class such as `CustomersUiConnector`.

```java
// ordered, key fields are first
private final String[] propertyNames = {
     "CustomerId",
     "City",
     "Country",
     "DateOfBirth",
     "EmailAddress",
     "FirstName",
     "HouseNumber",
     "LastName",
     "PhoneNumber",
     "PostalCode",
     "Street"
};
```


## Show a Custom Screen
The first screen shown following the onboarding screens is the `EntitySetListActivity` screen.  To instead show a different screen, modify `LogonActivity.java` and in the method `startEntitySetListActivity`, make the change below.
```java
//Intent intent = new Intent(LogonActivity.this, EntitySetListActivity.class);
Intent intent = new Intent(LogonActivity.this, MyFirstActivity.class);
```

## Push Notifications
If the option Enable Push was checked on the Project Configuration page of the wizard, classes to enable the app to receive push notifications appear in the package `fcm`.  One customization might be to change the title of the notification message if it is not included in the received message.  To do this, edit `PushNotificationBroadcastReceiver.java` and in the `onReceive` method modify the value of notificationTitle.


## Configuration Loader

The Configuration Loader is used to acquire general, non-secure configuration information, such as the Service URL from one of several sources. These sources include the Android Managed Configuration (previously known as application restrictions), an embedded resource file, or the Discovery Service. The sources are tried in the above order until a valid configuration is returned or no input is supplied for a provider, such as the Discovery Service that requires input. By default, the configuration data is persisted to shared preferences. Subsequently, the data is retrieved from shared preferences and kept in the `ConfigurationData` object. The `ConfigurationData` object is contained in the `SAPWizardApplication` application object and accessed through the `getConfigurationData` method.

When a wizard generated application is initially started or reset, it needs to be onboarded. The onboarding process encompasses getting the configuration data and the initial authentication with the server. The onboarding process is handled by the launch screen activity, which invokes the `startStandardOnboarding` method of the `LaunchScreenActionHandlerImpl` class. The `startStandardOnboarding` method checks to see if there already is configuration data in shared preferences from a prior invocation and if so it moves on. Otherwise the `ConfigurationLoader` is run asynchronously through the `startConfigurationLoader` private method. The `startStandardOnboarding` method then loops until a configuration is successfully loaded or the loader fails. During this loop, the loader may request user input. If so, the private method `promptForProviderInput` is called to obtain it. Upon success, `startStandardOnboarding` performs the initial sever authentication, successfully exits the activity and onboarding is complete. Upon any failure, `startStandardOnboarding` returns and is re-invoked to try again.

The `startConfigurationLoader` private method simply instantiates a `ConfigurationLoader` object and calls `loadConfiguration` on it in a UI thread. The `loadConfiguration` method runs the loader in its own non-UI thread. The two threads communicate through messages passed through the `ConfigurationLoaderCallback` object methods and the `ConfigurationLoader.processRequestedInputs` method.

The `ConfigurationLoader` has several constructors. The one currently used employs the default queue and supplies the hard-coded Application ID to the discovery service provider. If desired, a developer can modify `startConfigurationLoader` and define their own configuration provider queue and pass it to the `ConfigurationLoader` constructor which takes a Context, the `ConfigurationLoaderCallback`, and a provider queue. The provider queue is simply an array of `ConfigurationProvider` objects in the order in which one wants them tried.


## Troubleshooting

While you are syncing the project, a `warning message` can appear in Android Studio.
"Could not find google-services.json while looking in [src/nullnull/debug, src/debug/nullnull, src/nullnull, src/debug, src/nullnullDebug]
registerResGeneratingTask is depricated, use registerGeneratedResFolders(FileCollection)"

You can ignore this warning message, it won't cause any problem.
